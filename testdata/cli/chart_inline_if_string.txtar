# Inline if/else inside YAML string value produces valid CUE.
# https://github.com/cue-exp/helm2cue/issues/40
exec helm2cue chart chartdir outdir
cmp stderr stderr.golden
cmp outdir/test.cue expected/test.cue

-- chartdir/Chart.yaml --
apiVersion: v2
name: test-app
version: 0.1.0
-- chartdir/values.yaml --
tls: true
certManager: true
-- chartdir/templates/test.yaml --
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: test
    args:
    {{- if .Values.tls }}
    - "--cert={{ if .Values.certManager }}tls.crt{{ else }}cert{{ end }}"
    {{- end }}
-- stderr.golden --
converted 1/1 templates from test-app
-- expected/test.cue --
// Code generated by helm2cue; DO NOT EDIT.

package test_app

test: [{
	apiVersion: "v1"
	kind:       "Pod"
	spec: {
		containers: [
			{
				name: "test"
				args: [
					if (_nonzero & {#arg: #values.tls, _}) {
						if (_nonzero & {#arg: #values.certManager, _}) {
							"\"--cert=tls.crt\""
						}
						if !(_nonzero & {#arg: #values.certManager, _}) {
							"\"--cert=cert\""
						}
					},
				]
			},
		]
	}
}]
