# Chart with helper referencing .Chart.Annotations â€” currently
# the generated #chart definition is closed and only has
# Name/Version/AppVersion, so cue vet fails with "undefined field".
# https://github.com/cue-exp/helm2cue/issues/41
exec helm2cue chart chartdir outdir
cmp stderr stderr.golden
cmp outdir/context.cue expected/context.cue

-- chartdir/Chart.yaml --
apiVersion: v2
name: test-app
version: 0.1.0
-- chartdir/values.yaml --
enabled: true
-- chartdir/templates/_helpers.tpl --
{{- define "test.fips" -}}
{{- if .Chart.Annotations.fips }}true{{ else }}false{{ end -}}
{{- end -}}
-- chartdir/templates/test.yaml --
apiVersion: v1
kind: ConfigMap
metadata:
  name: test
data:
  fips: {{ include "test.fips" . }}
-- stderr.golden --
converted 1/1 templates from test-app
-- expected/context.cue --
// Code generated by helm2cue; DO NOT EDIT.

package test_app

#chart: {
	Name:       "test-app"
	Version:    "0.1.0"
	AppVersion: ""
}
