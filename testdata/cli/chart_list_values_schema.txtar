# Template that uses volumes as a list (range) is skipped due to an
# unsupported function; only the conditional check survives. The
# inferred schema types the field as scalar, conflicting with the
# [] value in values.yaml.
# https://github.com/cue-exp/helm2cue/issues/41
exec helm2cue chart chartdir outdir
stderr 'skipping deployment.yaml'
stderr 'values.yaml does not satisfy inferred schema'
stderr 'converted 1/2 templates'
cmp outdir/values.cue expected/values.cue

-- chartdir/Chart.yaml --
apiVersion: v2
name: test-app
version: 0.1.0
-- chartdir/values.yaml --
volumes: []
-- chartdir/templates/deployment.yaml --
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      {{- range .Values.volumes }}
      - name: {{ .name }}
        {{- $s := genCA "test" 365 }}
      {{- end }}
-- chartdir/templates/configmap.yaml --
apiVersion: v1
kind: ConfigMap
metadata:
  name: test
data:
  {{- if .Values.volumes }}
  hasVolumes: "true"
  {{- end }}
-- expected/values.cue --
// Code generated by helm2cue; DO NOT EDIT.

package test_app

#values: {
	volumes?: bool | number | string | null
	...
}
